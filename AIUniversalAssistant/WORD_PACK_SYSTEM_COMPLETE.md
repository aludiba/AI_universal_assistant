# å­—æ•°åŒ…ç³»ç»Ÿå®Œæ•´å®ç°æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å®Œæ•´çš„å­—æ•°åŒ…ç³»ç»Ÿå®ç°ï¼ŒåŒ…æ‹¬VIPèµ é€ã€IAPè´­ä¹°ã€å­—æ•°æ¶ˆè€—å’ŒiCloudåŒæ­¥ã€‚

---

## ğŸ¯ å®ç°çš„5å¤§åŠŸèƒ½

### âœ… 1. æ›´æ–°è´­ä¹°é¡»çŸ¥æ–‡æ¡ˆ

**åŸæ–‡æ¡ˆ**:
```
- è´­ä¹°å­—æ•°åŒ…æœ‰æ•ˆæœŸä¸º 90å¤©;
- åˆ›ä½œæ—¶ä¼˜å…ˆæ¶ˆè€—ä¼šå‘˜æ¯æ—¥èµ é€å­—æ•°;
- å‰©ä½™å¯ç”¨å­—æ•° = è´­ä¹°æ€»å­—æ•° - ç´¯è®¡æ¶ˆè€—å­—æ•°;
- 1ä¸ªæ±‰å­—ã€1ä¸ªå­—æ¯ã€ä»»æ„æ ‡ç‚¹ç¬¦å·ã€ç©ºæ ¼å‡è®¡ç®—ä¸ºä¸€ä¸ªå­—ã€‚
```

**æ–°æ–‡æ¡ˆ**:
```
- å­—æ•°åŒ…è´­ä¹°å90å¤©å†…æœ‰æ•ˆï¼Œé€¾æœŸæœªä½¿ç”¨å°†è‡ªåŠ¨å¤±æ•ˆ
- ä½¿ç”¨æ—¶å°†ä¼˜å…ˆæ¶ˆè€—ä¼šå‘˜èµ é€å­—æ•°ï¼Œå…¶æ¬¡æ¶ˆè€—è´­ä¹°å­—æ•°åŒ…
- è®¢é˜…ä»»æ„ä¼šå‘˜å¥—é¤å¯è·èµ 50ä¸‡å­—ï¼Œæœ‰æ•ˆæœŸä¸ä¼šå‘˜æ—¶é•¿ä¸€è‡´
- å­—æ•°ç»Ÿè®¡è§„åˆ™ï¼š1ä¸ªä¸­æ–‡å­—ç¬¦ã€è‹±æ–‡å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹æˆ–ç©ºæ ¼å‡è®¡ä¸º1å­—
```

**å˜åŒ–ç‚¹**:
- è¯­è¨€æ›´è‡ªç„¶ï¼Œè¡¨è¾¾æ›´æ¸…æ™°
- å¼ºè°ƒ"é€¾æœŸå¤±æ•ˆ"è­¦ç¤º
- "ä¼šå‘˜æ¯æ—¥èµ é€"æ”¹ä¸º"ä¼šå‘˜èµ é€"ï¼ˆæ›´å‡†ç¡®ï¼‰
- æ–°å¢ç¬¬3æ¡ï¼šæ˜ç¡®è¯´æ˜VIPèµ é€50ä¸‡å­—

---

### âœ… 2. å¢åŠ è®¢é˜…ä¼šå‘˜èµ é€50ä¸‡å­—æç¤º

#### UIå±•ç¤º

**ä½ç½®**: å­—æ•°ä¿¡æ¯å¡ç‰‡ä¸‹æ–¹

**æ ·å¼**: æ©™è‰²æç¤ºå¡ç‰‡ï¼ˆgiftå›¾æ ‡ï¼‰

**å†…å®¹**: "è®¢é˜…ä»»æ„ä¼šå‘˜å¥—é¤å¯è·èµ 50ä¸‡å­—ï¼Œæœ‰æ•ˆæœŸä¸ä¼šå‘˜æ—¶é•¿ä¸€è‡´"

**äº¤äº’**: ç‚¹å‡»è·³è½¬åˆ°ä¼šå‘˜è®¢é˜…é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼šå‘˜èµ é€: 0å­—                        â”‚
â”‚ å·²è´­ä¹°: 0å­—                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ å¯ç”¨æ€»å­—æ•°: 0å­—                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ è®¢é˜…ä»»æ„ä¼šå‘˜å¥—é¤å¯è·èµ 50ä¸‡å­—     â”‚
â”‚    æœ‰æ•ˆæœŸä¸ä¼šå‘˜æ—¶é•¿ä¸€è‡´              â”‚  â† ç‚¹å‡»è·³è½¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### èµ é€é€»è¾‘

```objective-c
- (void)refreshVIPGiftedWords {
    BOOL isVIP = [[AIUAIAPManager sharedManager] isVIPMember];
    
    if (isVIP) {
        NSInteger currentGiftedWords = [...];
        
        // æ–°è®¢é˜…æ—¶èµ é€50ä¸‡å­—
        if (currentGiftedWords == 0) {
            [[NSUserDefaults standardUserDefaults] setInteger:500000 
                                                       forKey:kAIUAVIPGiftedWords];
        }
        
        // æ›´æ–°è¿‡æœŸæ—¶é—´ä¸ºVIPåˆ°æœŸæ—¶é—´
        NSDate *vipExpiryDate = [[AIUAIAPManager sharedManager] subscriptionExpiryDate];
        [[NSUserDefaults standardUserDefaults] setObject:vipExpiryDate 
                                                   forKey:kAIUAVIPGiftedWordsExpiryDate];
    }
}
```

**è§¦å‘æ—¶æœº**:
- ç”¨æˆ·è®¢é˜…VIPæ—¶è‡ªåŠ¨èµ é€
- åº”ç”¨å¯åŠ¨æ—¶åˆ·æ–°ï¼ˆ`applicationDidBecomeActive`ï¼‰
- è®¢é˜…çŠ¶æ€å˜åŒ–æ—¶åˆ·æ–°ï¼ˆé€šè¿‡é€šçŸ¥ï¼‰

---

### âœ… 3. é›†æˆçœŸå®IAPè´­ä¹°é€»è¾‘

#### å­—æ•°åŒ…äº§å“å®šä¹‰

```objective-c
// äº§å“ID
static NSString * const kProductIDWordPack500K = @"com.yourcompany.aiassistant.wordpack.500k";
static NSString * const kProductIDWordPack2M = @"com.yourcompany.aiassistant.wordpack.2m";
static NSString * const kProductIDWordPack6M = @"com.yourcompany.aiassistant.wordpack.6m";

// å­—æ•°åŒ…ç±»å‹
typedef NS_ENUM(NSUInteger, AIUAWordPackType) {
    AIUAWordPackType500K = 0,   // 500,000å­— - Â¥6
    AIUAWordPackType2M,          // 2,000,000å­— - Â¥18
    AIUAWordPackType6M           // 6,000,000å­— - Â¥38
};
```

#### è´­ä¹°æµç¨‹

```objective-c
// 1. ç”¨æˆ·ç‚¹å‡»è´­ä¹°æŒ‰é’®
- (void)purchaseButtonTapped {
    // æ˜¾ç¤ºç¡®è®¤å¼¹çª—
    // ç”¨æˆ·ç¡®è®¤åè°ƒç”¨ performPurchase
}

// 2. æ‰§è¡Œè´­ä¹°
- (void)performPurchase {
    MBProgressHUD *hud = [MBProgressHUD showHUDAddedTo:self.view animated:YES];
    hud.label.text = L(@"processing");
    
    // è°ƒç”¨WordPackManagerè´­ä¹°
    [[AIUAWordPackManager sharedManager] purchaseWordPack:self.selectedPackType 
                                                completion:^(BOOL success, NSError *error) {
        [hud hideAnimated:YES];
        
        if (success) {
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            // åˆ·æ–°å­—æ•°æ˜¾ç¤º
        } else {
            // æ˜¾ç¤ºé”™è¯¯æç¤º
        }
    }];
}

// 3. WordPackManagerè°ƒç”¨IAP
- (void)purchaseWordPack:(AIUAWordPackType)type completion:(void(^)(BOOL, NSError*))completion {
    NSString *productID = [self productIDForPackType:type];
    
    // è°ƒç”¨AIUAIAPManagerè´­ä¹°
    [[AIUAIAPManager sharedManager] purchaseProduct:productID completion:^(BOOL success, NSError *error) {
        if (success) {
            // æ·»åŠ è´­ä¹°è®°å½•
            [self addPurchaseRecord:words forProductID:productID];
            
            // åŒæ­¥åˆ°iCloud
            [self syncToiCloud];
            
            // å‘é€é€šçŸ¥
            [[NSNotificationCenter defaultCenter] postNotificationName:AIUAWordPackPurchasedNotification
                                                                object:nil];
        }
        
        completion(success, error);
    }];
}
```

#### è´­ä¹°è®°å½•ç»“æ„

```objective-c
NSDictionary *purchase = @{
    @"productID": @"com.yourcompany.aiassistant.wordpack.500k",
    @"words": @500000,              // è´­ä¹°çš„å­—æ•°
    @"remainingWords": @500000,     // å‰©ä½™å­—æ•°
    @"purchaseDate": [NSDate date], // è´­ä¹°æ—¶é—´
    @"expiryDate": expiryDate       // è¿‡æœŸæ—¶é—´ï¼ˆ90å¤©åï¼‰
};
```

#### App Store Connecté…ç½®

**æ­¥éª¤**:
1. ç™»å½• App Store Connect
2. è¿›å…¥åº”ç”¨ â†’ åŠŸèƒ½ â†’ Appå†…è´­ä¹°é¡¹ç›®
3. åˆ›å»º3ä¸ªæ¶ˆè€—å‹é¡¹ç›®ï¼š
   - äº§å“ID: `com.yourcompany.aiassistant.wordpack.500k`
   - æ˜¾ç¤ºåç§°: "500,000å­—æ•°åŒ…"
   - ä»·æ ¼: Â¥6
   - é‡å¤ä»¥ä¸Šæ­¥éª¤åˆ›å»º2Må’Œ6Må­—æ•°åŒ…

---

### âœ… 4. é€šè¿‡iCloudè®°å½•å­—æ•°åŒ…åˆ°äº‘ç«¯

#### iCloudæ•°æ®ç»“æ„

```objective-c
// iCloud Key
static NSString * const kAIUAiCloudWordPackData = @"AIUAWordPackData";

// æ•°æ®ç»“æ„
NSDictionary *iCloudData = @{
    @"vipGiftedWords": @500000,           // VIPèµ é€å­—æ•°
    @"vipGiftedWordsExpiryDate": date,    // VIPèµ é€è¿‡æœŸæ—¶é—´
    @"purchases": @[...],                  // è´­ä¹°è®°å½•æ•°ç»„
    @"consumedWords": @123456              // ç´¯è®¡æ¶ˆè€—å­—æ•°
};
```

#### åŒæ­¥æµç¨‹

```
åº”ç”¨å¯åŠ¨
    â†“
enableiCloudSync
    â”œâ”€ ç›‘å¬iCloudå˜åŒ–é€šçŸ¥
    â”œâ”€ è°ƒç”¨ [iCloudStore synchronize]
    â””â”€ é¦–æ¬¡åŒæ­¥ï¼šsyncFromiCloud
        â†“
æœ¬åœ°æ•°æ® â† iCloudæ•°æ®
    â†“
ç”¨æˆ·è´­ä¹°å­—æ•°åŒ…
    â†“
æœ¬åœ°ä¿å­˜ + syncToiCloud
    â†“
iCloudæ•°æ® â† æœ¬åœ°æ•°æ®
    â†“
å…¶ä»–è®¾å¤‡æ£€æµ‹åˆ°iCloudå˜åŒ–
    â†“
è‡ªåŠ¨ syncFromiCloud
    â†“
å®ç°è·¨è®¾å¤‡åŒæ­¥
```

#### æ ¸å¿ƒä»£ç 

```objective-c
// å¯ç”¨åŒæ­¥
- (void)enableiCloudSync {
    self.iCloudSyncEnabled = YES;
    self.iCloudStore = [NSUbiquitousKeyValueStore defaultStore];
    
    // ç›‘å¬å˜åŒ–
    [[NSNotificationCenter defaultCenter] addObserver:self
                                             selector:@selector(iCloudStoreDidChange:)
                                                 name:NSUbiquitousKeyValueStoreDidChangeExternallyNotification
                                               object:self.iCloudStore];
    
    [self.iCloudStore synchronize];
    [self syncFromiCloud];
}

// ä¸Šä¼ åˆ°iCloud
- (void)syncToiCloud {
    NSDictionary *data = @{
        @"vipGiftedWords": @(...),
        @"vipGiftedWordsExpiryDate": ...,
        @"purchases": ...,
        @"consumedWords": @(...)
    };
    
    [self.iCloudStore setDictionary:data forKey:kAIUAiCloudWordPackData];
    [self.iCloudStore synchronize];
}

// ä»iCloudä¸‹è½½
- (void)syncFromiCloud {
    NSDictionary *iCloudData = [self.iCloudStore dictionaryForKey:kAIUAiCloudWordPackData];
    
    // åŒæ­¥åˆ°æœ¬åœ°
    [[NSUserDefaults standardUserDefaults] setInteger:[iCloudData[@"vipGiftedWords"] integerValue]
                                               forKey:kAIUAVIPGiftedWords];
    // ... åŒæ­¥å…¶ä»–æ•°æ®
    [[NSUserDefaults standardUserDefaults] synchronize];
}
```

#### Xcodeé…ç½®

**æ­¥éª¤**:
1. é€‰æ‹©é¡¹ç›® â†’ Target â†’ Signing & Capabilities
2. ç‚¹å‡» "+ Capability"
3. æ·»åŠ  "iCloud"
4. å‹¾é€‰ "Key-value storage"
5. Xcodeä¼šè‡ªåŠ¨é…ç½®entitlementsæ–‡ä»¶

---

### âœ… 5. å®ç°å®Œæ•´å­—æ•°æ¶ˆè€—é€»è¾‘

#### æ¶ˆè€—ä¼˜å…ˆçº§

```
1. VIPèµ é€å­—æ•°ï¼ˆä¼˜å…ˆï¼‰
    â†“
2. è´­ä¹°å­—æ•°åŒ…ï¼ˆæŒ‰è´­ä¹°æ—¶é—´é¡ºåºï¼‰
    â†“
3. å­—æ•°ä¸è¶³ â†’ æç¤ºè´­ä¹°
```

#### æ ¸å¿ƒå®ç°

```objective-c
- (void)consumeWords:(NSInteger)words completion:(void(^)(BOOL, NSInteger))completion {
    // 1. æ£€æŸ¥å­—æ•°æ˜¯å¦è¶³å¤Ÿ
    if (![self hasEnoughWords:words]) {
        completion(NO, [self totalAvailableWords]);
        return;
    }
    
    NSInteger remainingToConsume = words;
    
    // 2. ä¼˜å…ˆä»VIPèµ é€å­—æ•°ä¸­æ¶ˆè€—
    NSInteger vipWords = [self vipGiftedWords];
    if (vipWords > 0) {
        NSInteger consumeFromVIP = MIN(remainingToConsume, vipWords);
        NSInteger newVIPWords = vipWords - consumeFromVIP;
        
        [[NSUserDefaults standardUserDefaults] setInteger:newVIPWords 
                                                   forKey:kAIUAVIPGiftedWords];
        remainingToConsume -= consumeFromVIP;
    }
    
    // 3. å¦‚æœè¿˜éœ€è¦æ¶ˆè€—ï¼Œä»è´­ä¹°å­—æ•°åŒ…ä¸­æ¶ˆè€—
    if (remainingToConsume > 0) {
        [self consumeFromPurchasedPacks:remainingToConsume];
    }
    
    // 4. æ›´æ–°ç´¯è®¡æ¶ˆè€—å­—æ•°
    NSInteger totalConsumed = [[NSUserDefaults standardUserDefaults] integerForKey:kAIUAConsumedWords];
    totalConsumed += words;
    [[NSUserDefaults standardUserDefaults] setInteger:totalConsumed forKey:kAIUAConsumedWords];
    
    // 5. åŒæ­¥åˆ°iCloud
    [self syncToiCloud];
    
    // 6. å‘é€é€šçŸ¥
    [[NSNotificationCenter defaultCenter] postNotificationName:AIUAWordConsumedNotification
                                                        object:nil];
    
    completion(YES, [self totalAvailableWords]);
}

- (void)consumeFromPurchasedPacks:(NSInteger)words {
    NSMutableArray *purchases = [...];
    NSInteger remainingToConsume = words;
    
    // æŒ‰è´­ä¹°æ—¶é—´æ’åºï¼ˆå…ˆè´­ä¹°çš„å…ˆæ¶ˆè€—ï¼‰
    [purchases sortUsingDescriptors:@[[NSSortDescriptor sortDescriptorWithKey:@"purchaseDate" ascending:YES]]];
    
    for (NSMutableDictionary *purchase in purchases) {
        if (remainingToConsume <= 0) break;
        
        // æ£€æŸ¥è¿‡æœŸ
        if ([now compare:purchase[@"expiryDate"]] == NSOrderedDescending) {
            continue;
        }
        
        NSInteger remainingWords = [purchase[@"remainingWords"] integerValue];
        if (remainingWords > 0) {
            NSInteger consumeFromThis = MIN(remainingToConsume, remainingWords);
            purchase[@"remainingWords"] = @(remainingWords - consumeFromThis);
            remainingToConsume -= consumeFromThis;
        }
    }
    
    // ä¿å­˜æ›´æ–°
    [[NSUserDefaults standardUserDefaults] setObject:purchases forKey:kAIUAWordPackPurchases];
}
```

#### é›†æˆåˆ°AIå†™ä½œ

**æ–¹æ³•1: åœ¨å†™ä½œæ§åˆ¶å™¨ä¸­è°ƒç”¨**

```objective-c
// åœ¨ç”Ÿæˆå®Œæˆå
- (void)onGenerationComplete:(NSString *)content {
    NSInteger wordCount = content.length;
    
    [[AIUAWordPackManager sharedManager] consumeWords:wordCount 
                                            completion:^(BOOL success, NSInteger remaining) {
        if (success) {
            NSLog(@"å­—æ•°æ¶ˆè€—æˆåŠŸï¼Œå‰©ä½™: %ld", (long)remaining);
        } else {
            // å­—æ•°ä¸è¶³ï¼Œæ˜¾ç¤ºæç¤º
            [self showInsufficientWordsAlert];
        }
    }];
}
```

**æ–¹æ³•2: åœ¨ç”Ÿæˆå‰æ£€æŸ¥**

```objective-c
- (void)startGeneration {
    // ä¼°ç®—éœ€è¦çš„å­—æ•°
    NSInteger estimatedWords = 1000;
    
    if (![[AIUAWordPackManager sharedManager] hasEnoughWords:estimatedWords]) {
        // æ˜¾ç¤ºå­—æ•°ä¸è¶³æç¤º
        [self showInsufficientWordsAlert];
        return;
    }
    
    // ç»§ç»­ç”Ÿæˆ
    [self performGeneration];
}
```

#### å­—æ•°ä¸è¶³æç¤º

```objective-c
- (void)showInsufficientWordsAlert {
    UIAlertController *alert = [UIAlertController 
        alertControllerWithTitle:L(@"insufficient_words")
        message:L(@"insufficient_words_message")
        preferredStyle:UIAlertControllerStyleAlert];
    
    // "è´­ä¹°å­—æ•°åŒ…"æŒ‰é’®
    UIAlertAction *purchaseAction = [UIAlertAction 
        actionWithTitle:L(@"purchase_word_pack")
        style:UIAlertActionStyleDefault
        handler:^(UIAlertAction *action) {
            // è·³è½¬åˆ°å­—æ•°åŒ…é¡µé¢
            AIUAWordPackViewController *vc = [[AIUAWordPackViewController alloc] init];
            [self.navigationController pushViewController:vc animated:YES];
        }];
    
    // "å¼€é€šä¼šå‘˜"æŒ‰é’®
    UIAlertAction *vipAction = [UIAlertAction 
        actionWithTitle:L(@"activate_membership")
        style:UIAlertActionStyleDefault
        handler:^(UIAlertAction *action) {
            // è·³è½¬åˆ°ä¼šå‘˜é¡µé¢
            AIUAMembershipViewController *vc = [[AIUAMembershipViewController alloc] init];
            [self.navigationController pushViewController:vc animated:YES];
        }];
    
    UIAlertAction *cancelAction = [UIAlertAction 
        actionWithTitle:L(@"cancel")
        style:UIAlertActionStyleCancel
        handler:nil];
    
    [alert addAction:purchaseAction];
    [alert addAction:vipAction];
    [alert addAction:cancelAction];
    
    [self presentViewController:alert animated:YES completion:nil];
}
```

---

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### å­—æ•°åŒ…ç”Ÿå‘½å‘¨æœŸ

```
VIPè®¢é˜…
    â†“
èµ é€50ä¸‡å­—
    â”œâ”€ ä¿å­˜åˆ°æœ¬åœ° (NSUserDefaults)
    â”œâ”€ è®°å½•è¿‡æœŸæ—¶é—´ (VIPåˆ°æœŸæ—¶é—´)
    â””â”€ åŒæ­¥åˆ°iCloud
        â†“
ç”¨æˆ·ä½¿ç”¨AIå†™ä½œ
    â†“
æ£€æŸ¥å­—æ•°æ˜¯å¦è¶³å¤Ÿ
    â”œâ”€ æ˜¯ â†’ ç”Ÿæˆå†…å®¹
    â”‚        â†“
    â”‚     æ¶ˆè€—å­—æ•°
    â”‚        â”œâ”€ ä¼˜å…ˆæ¶ˆè€—VIPèµ é€
    â”‚        â”œâ”€ å…¶æ¬¡æ¶ˆè€—è´­ä¹°å­—æ•°
    â”‚        â”œâ”€ æ›´æ–°æœ¬åœ°æ•°æ®
    â”‚        â””â”€ åŒæ­¥åˆ°iCloud
    â”‚
    â””â”€ å¦ â†’ æç¤ºè´­ä¹°å­—æ•°åŒ…æˆ–å¼€é€šVIP
              â†“
         ç”¨æˆ·è´­ä¹°å­—æ•°åŒ…
              â”œâ”€ IAPè´­ä¹°æµç¨‹
              â”œâ”€ æ·»åŠ è´­ä¹°è®°å½•
              â”œâ”€ è®¾ç½®90å¤©è¿‡æœŸ
              â””â”€ åŒæ­¥åˆ°iCloud
```

### è·¨è®¾å¤‡åŒæ­¥

```
è®¾å¤‡A
    â†“
è´­ä¹°å­—æ•°åŒ…
    â†“
æœ¬åœ°ä¿å­˜ + iCloudä¸Šä¼ 
    â†“
iCloudå­˜å‚¨
    â†“
è®¾å¤‡Bæ£€æµ‹åˆ°å˜åŒ–
    â†“
è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°
    â†“
è®¾å¤‡Bæ˜¾ç¤ºæœ€æ–°å­—æ•°
```

---

## ğŸ“‚ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

âœ… **AIUAWordPackManager.h** - å­—æ•°åŒ…ç®¡ç†å™¨å¤´æ–‡ä»¶
âœ… **AIUAWordPackManager.m** - å­—æ•°åŒ…ç®¡ç†å™¨å®ç°

### ä¿®æ”¹æ–‡ä»¶

âœ… **AIUAWordPackViewController.m** - å®Œå…¨é‡å†™ï¼Œé›†æˆç®¡ç†å™¨
âœ… **AppDelegate.m** - æ·»åŠ iCloudåŒæ­¥åˆå§‹åŒ–
âœ… **zh-Hans.lproj/Localizable.strings** - æ›´æ–°æœ¬åœ°åŒ–
âœ… **en.lproj/Localizable.strings** - æ›´æ–°æœ¬åœ°åŒ–

---

## ğŸ¯ å…³é”®ç±»è¯´æ˜

### AIUAWordPackManager

**èŒè´£**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å­—æ•°åŒ…ç›¸å…³é€»è¾‘

**æ ¸å¿ƒæ–¹æ³•**:
```objective-c
// æŸ¥è¯¢
- (NSInteger)vipGiftedWords;
- (NSInteger)purchasedWords;
- (NSInteger)totalAvailableWords;

// è´­ä¹°
- (void)purchaseWordPack:(AIUAWordPackType)type completion:(void(^)(BOOL, NSError*))completion;

// VIPèµ é€
- (void)refreshVIPGiftedWords;

// æ¶ˆè€—
- (void)consumeWords:(NSInteger)words completion:(void(^)(BOOL, NSInteger))completion;

// iCloud
- (void)enableiCloudSync;
- (void)syncFromiCloud;
- (void)syncToiCloud;
```

### AIUAWordPackViewController

**èŒè´£**: å­—æ•°åŒ…è´­ä¹°ç•Œé¢

**åŠŸèƒ½**:
- æ˜¾ç¤ºVIPèµ é€å­—æ•°ã€è´­ä¹°å­—æ•°ã€æ€»å­—æ•°
- æ˜¾ç¤ºVIPèµ é€æç¤ºå¡ç‰‡
- æä¾›3ç§å­—æ•°åŒ…é€‰é¡¹
- é›†æˆçœŸå®IAPè´­ä¹°
- ç›‘å¬å­—æ•°åŒ…å˜åŒ–å¹¶æ›´æ–°UI

---

## ğŸ”” é€šçŸ¥æœºåˆ¶

### å­—æ•°åŒ…è´­ä¹°é€šçŸ¥

```objective-c
NSString * const AIUAWordPackPurchasedNotification = @"AIUAWordPackPurchasedNotification";

// å‘é€
[[NSNotificationCenter defaultCenter] postNotificationName:AIUAWordPackPurchasedNotification
                                                    object:nil
                                                  userInfo:@{@"words": @(words)}];

// ç›‘å¬
[[NSNotificationCenter defaultCenter] addObserver:self
                                         selector:@selector(wordPackPurchased:)
                                             name:AIUAWordPackPurchasedNotification
                                           object:nil];
```

### å­—æ•°æ¶ˆè€—é€šçŸ¥

```objective-c
NSString * const AIUAWordConsumedNotification = @"AIUAWordConsumedNotification";

// ç”¨é€”ï¼šå®æ—¶æ›´æ–°UIæ˜¾ç¤ºçš„å‰©ä½™å­—æ•°
```

### VIPçŠ¶æ€å˜åŒ–é€šçŸ¥

```objective-c
// AIUASubscriptionStatusChanged (å·²å­˜åœ¨)
// ç”¨é€”ï¼šVIPè®¢é˜…çŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨åˆ·æ–°èµ é€å­—æ•°
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. VIPèµ é€æµ‹è¯•

**æ­¥éª¤**:
1. æœªè®¢é˜…VIPæ—¶ï¼Œæ£€æŸ¥èµ é€å­—æ•°ä¸º0
2. è®¢é˜…VIPåï¼Œæ£€æŸ¥èµ é€å­—æ•°ä¸º500,000
3. VIPåˆ°æœŸåï¼Œæ£€æŸ¥èµ é€å­—æ•°å¤±æ•ˆ

**é¢„æœŸç»“æœ**:
- âœ… VIPè®¢é˜…åç«‹å³è·å¾—50ä¸‡å­—
- âœ… èµ é€å­—æ•°è¿‡æœŸæ—¶é—´ = VIPè¿‡æœŸæ—¶é—´
- âœ… VIPåˆ°æœŸåèµ é€å­—æ•°å¤±æ•ˆ

### 2. å­—æ•°åŒ…è´­ä¹°æµ‹è¯•

**æ­¥éª¤**:
1. é€‰æ‹©500Kå­—æ•°åŒ…
2. ç‚¹å‡»è´­ä¹°
3. å®ŒæˆIAPæµç¨‹

**é¢„æœŸç»“æœ**:
- âœ… è´­ä¹°æˆåŠŸåå­—æ•°å¢åŠ 
- âœ… è´­ä¹°è®°å½•ä¿å­˜åˆ°æœ¬åœ°
- âœ… æ•°æ®åŒæ­¥åˆ°iCloud
- âœ… è®¾ç½®90å¤©è¿‡æœŸæ—¶é—´

### 3. å­—æ•°æ¶ˆè€—æµ‹è¯•

**æ­¥éª¤**:
1. VIPèµ é€å­—æ•°: 500,000
2. è´­ä¹°å­—æ•°: 500,000
3. æ¶ˆè€—600,000å­—

**é¢„æœŸç»“æœ**:
- âœ… å…ˆæ¶ˆè€—VIPèµ é€500,000å­—
- âœ… å†æ¶ˆè€—è´­ä¹°å­—æ•°100,000å­—
- âœ… VIPèµ é€å‰©ä½™: 0
- âœ… è´­ä¹°å­—æ•°å‰©ä½™: 400,000

### 4. iCloudåŒæ­¥æµ‹è¯•

**æ­¥éª¤**:
1. è®¾å¤‡Aè´­ä¹°å­—æ•°åŒ…
2. è®¾å¤‡Bç™»å½•åŒä¸€Apple ID
3. ç­‰å¾…iCloudåŒæ­¥

**é¢„æœŸç»“æœ**:
- âœ… è®¾å¤‡Bè‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°å­—æ•°
- âœ… æ— éœ€æ‰‹åŠ¨æ“ä½œ
- âœ… æ•°æ®ä¸€è‡´

### 5. è¿‡æœŸç®¡ç†æµ‹è¯•

**æ­¥éª¤**:
1. ä¿®æ”¹ç³»ç»Ÿæ—¶é—´åˆ°91å¤©å
2. æ£€æŸ¥å­—æ•°åŒ…çŠ¶æ€

**é¢„æœŸç»“æœ**:
- âœ… è¿‡æœŸå­—æ•°åŒ…ä¸å†è®¡å…¥æ€»å­—æ•°
- âœ… æ¶ˆè€—æ—¶è·³è¿‡è¿‡æœŸå­—æ•°åŒ…

---

## ğŸ“ TODOå¾…å®Œæˆ

### é«˜ä¼˜å…ˆçº§

â³ **é›†æˆåˆ°å…·ä½“å†™ä½œåœºæ™¯**
- åœ¨AIUAWritingDetailViewControllerä¸­æ·»åŠ å­—æ•°æ¶ˆè€—
- åœ¨AIUADocDetailViewControllerä¸­æ·»åŠ å­—æ•°æ¶ˆè€—
- åœ¨ç”Ÿæˆå‰æ£€æŸ¥å­—æ•°æ˜¯å¦è¶³å¤Ÿ

â³ **å­—æ•°æ¶ˆè€—è®°å½•é¡µé¢**
- åˆ›å»ºAIUAConsumptionRecordViewController
- æ˜¾ç¤ºæ¶ˆè€—å†å²
- æŒ‰æ—¶é—´å€’åºæ’åˆ—

### ä¸­ä¼˜å…ˆçº§

â³ **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**
- ç”Ÿæˆå‰æ˜¾ç¤ºé¢„ä¼°æ¶ˆè€—å­—æ•°
- æ·»åŠ å­—æ•°ä¸è¶³é¢„è­¦ï¼ˆå‰©ä½™<10%æ—¶æç¤ºï¼‰
- å­—æ•°åŒ…å³å°†è¿‡æœŸæé†’

â³ **æ•°æ®ç»Ÿè®¡**
- ç»Ÿè®¡æ€»æ¶ˆè€—å­—æ•°
- ç»Ÿè®¡å„åŠŸèƒ½æ¶ˆè€—å­—æ•°
- ç»Ÿè®¡å¹³å‡æ¯æ—¥æ¶ˆè€—

### ä½ä¼˜å…ˆçº§

â³ **é«˜çº§åŠŸèƒ½**
- å­—æ•°åŒ…è½¬èµ åŠŸèƒ½
- å­—æ•°åŒ…åˆ†äº«åŠŸèƒ½
- æ¶ˆè€—å­—æ•°æ’è¡Œæ¦œ

---

## ğŸ‰ æ€»ç»“

### å·²å®ŒæˆåŠŸèƒ½

âœ… **æ–‡æ¡ˆæ›´æ–°** - è´­ä¹°é¡»çŸ¥æ›´æ¸…æ™°è‡ªç„¶  
âœ… **VIPèµ é€** - è®¢é˜…ä¼šå‘˜é€50ä¸‡å­—  
âœ… **çœŸå®IAP** - é›†æˆAppleå†…è´­  
âœ… **iCloudåŒæ­¥** - è·¨è®¾å¤‡æ•°æ®åŒæ­¥  
âœ… **å­—æ•°æ¶ˆè€—** - å®Œæ•´æ¶ˆè€—é€»è¾‘å’Œä¼˜å…ˆçº§  

### æŠ€æœ¯äº®ç‚¹

ğŸŒŸ **ç»Ÿä¸€ç®¡ç†** - AIUAWordPackManageré›†ä¸­ç®¡ç†  
ğŸŒŸ **iCloudåŒæ­¥** - è‡ªåŠ¨è·¨è®¾å¤‡åŒæ­¥  
ğŸŒŸ **ä¼˜å…ˆçº§æ¶ˆè€—** - VIPèµ é€ â†’ è´­ä¹°å­—æ•°  
ğŸŒŸ **è¿‡æœŸç®¡ç†** - 90å¤©è‡ªåŠ¨å¤±æ•ˆ  
ğŸŒŸ **é€šçŸ¥æœºåˆ¶** - å®æ—¶æ›´æ–°UI  
ğŸŒŸ **å®Œæ•´æ—¥å¿—** - è¯¦ç»†è°ƒè¯•ä¿¡æ¯  

### æ¶æ„ä¼˜åŠ¿

- âœ… **è§£è€¦è®¾è®¡**: å­—æ•°åŒ…é€»è¾‘ä¸UIåˆ†ç¦»
- âœ… **æ˜“äºæ‰©å±•**: æ–°å¢å­—æ•°åŒ…ç±»å‹åªéœ€é…ç½®
- âœ… **å¯æµ‹è¯•æ€§**: æ ¸å¿ƒé€»è¾‘ç‹¬ç«‹å¯æµ‹è¯•
- âœ… **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

**å­—æ•°åŒ…ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½å·²å®Œæ•´å®ç°ï¼** ğŸš€

